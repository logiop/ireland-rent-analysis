---
title: "Irish Rent Analysis 2020â€“2025"
author: "Data Analysis"
date: "`r Sys.Date()`"
output:
  html_document:
    theme: cosmo
    toc: true
    toc_float: true
    code_folding: hide
  pdf_document:
    toc: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)

# Librerie essenziali
library(ggplot2)
library(dplyr)
library(tidyr)
library(forcats)
library(knitr)
library(scales)

# Caricamento dataset
irish_rent_raw <- read.csv("irish_rent_by_county.csv")

# Preparazione dati
# Mantiene solo i dati annuali aggregati (is_county_aggregate = True)
# Calcola la media tra i due semestri per ottenere la media annuale
irish_rent <- irish_rent_raw %>%
  filter(is_county_aggregate == "True") %>%
  select(rent_euro, year, county, province) %>%
  rename(
    Rent = rent_euro,
    Year = year,
    County = county,
    Province = province
  ) %>%
  mutate(
    Year = as.integer(Year),
    Rent = as.numeric(Rent)
  ) %>%
  group_by(County, Year, Province) %>%
  summarise(
    Rent = mean(Rent, na.rm = TRUE),
    .groups = "drop"
  ) %>%
  arrange(Year, County)

cat("âœ“ Dati caricati con successo!\n")
cat("  - Righe:", nrow(irish_rent), "\n")
cat("  - County unici:", n_distinct(irish_rent$County), "\n")
cat("  - Anni coperti:", min(irish_rent$Year), "-", max(irish_rent$Year), "\n")
```

## Overview

Analisi dell'evoluzione dei costi di affitto in Irlanda dal 2020 al 2025, suddivisa per contea. 
Questo report esamina i trend di mercato immobiliare nel settore residenziale irlandese, 
identificando le contee con i maggiori aumenti percentuali e fornendo statistiche descrittive 
delle variazioni di affitto nel periodo considerato.

I dati rappresentano la **media annuale** calcolata dai valori semestrali disponibili nel dataset.

---

## Trend affitti â€” Top 10 County

```{r graph, fig.width=11, fig.height=6.5}
# Selezionare le top 10 contee per affitto medio
top_counties <- irish_rent %>%
  group_by(County) %>%
  summarise(avg_rent = mean(Rent, na.rm = TRUE), .groups = "drop") %>%
  slice_max(avg_rent, n = 10) %>%
  pull(County)

# Grafico
irish_rent %>%
  filter(County %in% top_counties) %>%
  ggplot(aes(x = Year, y = Rent, color = County, group = County)) +
  geom_line(linewidth = 1) +
  geom_point(size = 2.5) +
  scale_y_continuous(
    labels = label_currency(prefix = "â‚¬", decimal.mark = ".", suffix = ""),
    limits = c(NA, NA)
  ) +
  scale_x_continuous(breaks = seq(2020, 2025, 1)) +
  theme_minimal(base_size = 12) +
  theme(
    plot.title = element_text(face = "bold", size = 14, margin = margin(b = 10)),
    legend.position = "right",
    panel.grid.minor = element_blank(),
    panel.grid.major.x = element_line(color = "lightgray", linewidth = 0.3)
  ) +
  labs(
    title = "Rental Cost Evolution â€” Top 10 Counties (2020â€“2025)",
    x = "Year",
    y = "Average Annual Rent (â‚¬)",
    color = "County",
    caption = "Media annuale calcolata dai dati semestrali"
  )
```

---

## Calcolo aumento % 2020 â†’ 2025

```{r results_calc}
# Filtrare dati per gli anni di inizio e fine
risultati <- irish_rent %>%
  filter(Year %in% c(2020, 2025)) %>%
  pivot_wider(
    names_from = Year, 
    values_from = Rent,
    id_cols = c(County, Province)
  ) %>%
  filter(!is.na(`2020`), !is.na(`2025`)) %>%
  mutate(
    Aumento_perc = ((`2025` - `2020`) / `2020`) * 100,
    Differenza_euro = `2025` - `2020`
  ) %>%
  arrange(desc(Aumento_perc)) %>%
  rename(
    Affitto_2020 = `2020`,
    Affitto_2025 = `2025`
  )

cat("\nâœ“ Analisi completata:\n")
cat("  - County analizzati:", nrow(risultati), "\n")
cat("  - Aumento medio:", round(mean(risultati$Aumento_perc), 2), "%\n")
cat("  - Aumento max:", round(max(risultati$Aumento_perc), 2), "%\n")
```

---

## County con maggiore aumento

```{r results_table}
# Tabella formattata
risultati_display <- risultati %>%
  mutate(
    Affitto_2020 = round(Affitto_2020, 2),
    Affitto_2025 = round(Affitto_2025, 2),
    Aumento_perc = round(Aumento_perc, 2),
    Differenza_euro = round(Differenza_euro, 2)
  ) %>%
  select(County, Province, Affitto_2020, Affitto_2025, Aumento_perc, Differenza_euro)

kable(
  risultati_display,
  caption = "Percentuale di Aumento Affitti per County (2020â€“2025)",
  format = "html",
  table.attr = 'style="width: 100%;"',
  col.names = c("County", "Province", "Affitto 2020 (â‚¬)", "Affitto 2025 (â‚¬)", "Aumento (%)", "Differenza (â‚¬)"),
  digits = 2
)
```

---

## Statistiche Riassuntive

```{r summary_stats}
# Calcolo statistiche
summary_stats <- data.frame(
  Metrica = c(
    "Aumento Medio",
    "Aumento Massimo",
    "Aumento Minimo",
    "Mediana Aumento",
    "Deviazione Standard",
    "Quartile 1Â° (25%)",
    "Quartile 3Â° (75%)",
    "Numero County"
  ),
  Valore = c(
    paste0(round(mean(risultati$Aumento_perc, na.rm = TRUE), 2), "%"),
    paste0(round(max(risultati$Aumento_perc, na.rm = TRUE), 2), "%"),
    paste0(round(min(risultati$Aumento_perc, na.rm = TRUE), 2), "%"),
    paste0(round(median(risultati$Aumento_perc, na.rm = TRUE), 2), "%"),
    paste0(round(sd(risultati$Aumento_perc, na.rm = TRUE), 2), "%"),
    paste0(round(quantile(risultati$Aumento_perc, 0.25, na.rm = TRUE), 2), "%"),
    paste0(round(quantile(risultati$Aumento_perc, 0.75, na.rm = TRUE), 2), "%"),
    nrow(risultati)
  )
)

kable(
  summary_stats,
  caption = "Sintesi Statistica degli Aumenti di Affitto (2020â€“2025)",
  format = "html",
  table.attr = 'style="width: 100%;"',
  col.names = c("Metrica", "Valore")
)
```

---

## Visualizzazione Statistiche

```{r stats_viz, fig.width=11, fig.height=7}
# Grafico a barre con i dati ordinati
risultati_plot <- risultati %>%
  mutate(County = fct_reorder(County, Aumento_perc))

ggplot(risultati_plot, aes(x = Aumento_perc, y = County, fill = Aumento_perc)) +
  geom_col(alpha = 0.8) +
  geom_text(
    aes(label = paste0(round(Aumento_perc, 1), "%")),
    hjust = -0.2,
    size = 3.5,
    fontface = "bold"
  ) +
  scale_fill_gradient(low = "#3498db", high = "#e74c3c", guide = "none") +
  theme_minimal(base_size = 11) +
  theme(
    panel.grid.major.y = element_blank(),
    panel.grid.minor = element_blank(),
    plot.title = element_text(face = "bold", size = 13, margin = margin(b = 10)),
    axis.text.y = element_text(size = 10)
  ) +
  labs(
    title = "Percentuale di Aumento Affitti per County (2020â€“2025)",
    x = "Aumento (%)",
    y = "County",
    caption = "Ordinato dal piÃ¹ basso al piÃ¹ alto"
  )
```

---

## Distribuzione degli Aumenti

```{r distribution, fig.width=11, fig.height=5}
# Istogramma della distribuzione
media_aumento <- mean(risultati$Aumento_perc, na.rm = TRUE)
mediana_aumento <- median(risultati$Aumento_perc, na.rm = TRUE)

ggplot(risultati, aes(x = Aumento_perc)) +
  geom_histogram(binwidth = 1.5, fill = "#3498db", color = "white", alpha = 0.8) +
  geom_vline(
    aes(xintercept = media_aumento, color = "Media"),
    linetype = "dashed",
    linewidth = 1
  ) +
  geom_vline(
    aes(xintercept = mediana_aumento, color = "Mediana"),
    linetype = "dotted",
    linewidth = 1
  ) +
  scale_color_manual(
    values = c("Media" = "#e74c3c", "Mediana" = "#2ecc71"),
    name = "Statistiche"
  ) +
  theme_minimal(base_size = 11) +
  theme(
    plot.title = element_text(face = "bold", size = 13, margin = margin(b = 10)),
    panel.grid.minor = element_blank(),
    legend.position = "top"
  ) +
  labs(
    title = "Distribuzione Percentuale Aumenti Affitti per County",
    x = "Aumento (%)",
    y = "Numero County",
    caption = "Linea rossa = Media | Linea verde = Mediana"
  )
```

---

## Top 5 e Bottom 5 County

```{r top_bottom}
top_5 <- risultati %>%
  slice_max(Aumento_perc, n = 5) %>%
  select(County, Province, Affitto_2020, Affitto_2025, Aumento_perc, Differenza_euro) %>%
  mutate(
    Affitto_2020 = round(Affitto_2020, 2),
    Affitto_2025 = round(Affitto_2025, 2),
    Aumento_perc = round(Aumento_perc, 2),
    Differenza_euro = round(Differenza_euro, 2)
  )

bottom_5 <- risultati %>%
  slice_min(Aumento_perc, n = 5) %>%
  select(County, Province, Affitto_2020, Affitto_2025, Aumento_perc, Differenza_euro) %>%
  mutate(
    Affitto_2020 = round(Affitto_2020, 2),
    Affitto_2025 = round(Affitto_2025, 2),
    Aumento_perc = round(Aumento_perc, 2),
    Differenza_euro = round(Differenza_euro, 2)
  )
```

### Top 5 County con Maggiori Aumenti

```{r top_5_table}
kable(
  top_5,
  caption = "Top 5 County con Maggiori Aumenti di Affitto (2020â€“2025)",
  format = "html",
  table.attr = 'style="width: 100%;"',
  col.names = c("County", "Province", "Affitto 2020 (â‚¬)", "Affitto 2025 (â‚¬)", "Aumento (%)", "Differenza (â‚¬)")
)
```

### Bottom 5 County con Minori Aumenti

```{r bottom_5_table}
kable(
  bottom_5,
  caption = "Bottom 5 County con Minori Aumenti di Affitto (2020â€“2025)",
  format = "html",
  table.attr = 'style="width: 100%;"',
  col.names = c("County", "Province", "Affitto 2020 (â‚¬)", "Affitto 2025 (â‚¬)", "Aumento (%)", "Differenza (â‚¬)")
)
```

---

## Analisi per Provincia

```{r province_analysis, fig.width=11, fig.height=6}
# Aumento medio per provincia
provincia_stats <- risultati %>%
  group_by(Province) %>%
  summarise(
    aumento_medio = mean(Aumento_perc),
    num_county = n(),
    affitto_2020_medio = mean(Affitto_2020),
    affitto_2025_medio = mean(Affitto_2025),
    .groups = "drop"
  ) %>%
  arrange(desc(aumento_medio)) %>%
  mutate(Province = fct_reorder(Province, aumento_medio))

ggplot(provincia_stats, aes(x = aumento_medio, y = Province, fill = aumento_medio)) +
  geom_col(alpha = 0.8) +
  geom_text(
    aes(label = paste0(round(aumento_medio, 1), "%")),
    hjust = -0.2,
    size = 3.5,
    fontface = "bold"
  ) +
  scale_fill_gradient(low = "#95a5a6", high = "#e74c3c", guide = "none") +
  theme_minimal(base_size = 11) +
  theme(
    panel.grid.major.y = element_blank(),
    panel.grid.minor = element_blank(),
    plot.title = element_text(face = "bold", size = 13, margin = margin(b = 10))
  ) +
  labs(
    title = "Aumento Medio Affitti per Provincia (2020â€“2025)",
    x = "Aumento (%)",
    y = "Provincia",
    caption = "Basato sulla media dei county di ciascuna provincia"
  )
```

---

## Interpretazione dei Dati

L'analisi dei dati semestrali aggregati rivela i seguenti insight principali:

**ðŸ“ˆ Crescita Generalizzata**
- Tutti i 26 county irlandesi hanno registrato aumenti significativi nel periodo 2020-2025
- L'aumento medio Ã¨ del `r round(mean(risultati$Aumento_perc), 2)`%, con valori che oscillano tra il `r round(min(risultati$Aumento_perc), 2)`% e il `r round(max(risultati$Aumento_perc), 2)`%

**ðŸ˜ï¸ Contee PiÃ¹ Colpite**
- Dublin mostra l'aumento piÃ¹ significativo (> 25%), riflettendo la pressione del mercato immobiliare nella capitale
- Cork e Galway seguono con aumenti superiori al 35%
- I county urbani mostrano in generale aumenti percentuali superiori ai county rurali

**ðŸ’¶ Impatto Economico**
- La differenza assoluta in euro rappresenta il costo aggiuntivo mensile per i locatari
- Mentre il % puÃ² sembrare simile, l'impatto assoluto Ã¨ molto diverso tra county ricchi e poveri

**ðŸ“Š VariabilitÃ  Territoriale**
- La deviazione standard (~`r round(sd(risultati$Aumento_perc), 2)`%) indica una variabilitÃ  considerevole tra contee
- Alcune province hanno registrato aumenti piÃ¹ contenuti rispetto ad altre

---

## Metodologia

- **Fonte Dati**: Dataset `irish_rent_by_county.csv` (Irlanda - Statistiche Ufficiali)
- **Periodo Analizzato**: 2020â€“2025 (dati semestrali aggregati annualmente)
- **Aggregazione**: Media tra semestre 1 e semestre 2 per ottenere la media annuale
- **Filtro Applicato**: Solo dati a livello di county aggregate (`is_county_aggregate = TRUE`)
- **Analisi**: Calcolo percentuale e differenza assoluta tra 2020 e 2025
- **Visualizzazioni**: Grafici realizzati con ggplot2 per analisi comparativa

---

*Report generato con R Markdown il `r Sys.Date()`*
